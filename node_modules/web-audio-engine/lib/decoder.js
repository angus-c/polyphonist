"use strict";

var WavDecoder = require("wav-decoder");
var decoderUtil = require("./util/decoderUtil");
var audioDataUtil = require("./util/audioDataUtil");
var AudioBuffer = require("./api/AudioBuffer");

var decodeFn = WavDecoder.decode;

/**
 * @return {function}
 */
function get() {
  return decodeFn;
}

/**
 * @param {function} fn
 */
function set(fn) {
  /* istanbul ignore else */
  if (typeof fn === "function") {
    decodeFn = fn;
  }
}

/**
 * @param {ArrayBuffer} AudioBuffer
 * @param {object}      opts
 * @return {Promise<AudioData>}
 */
function decode(audioData, opts) {
  return decoderUtil.decode(decodeFn, audioData, opts).then(function (audioData) {
    return audioDataUtil.toAudioBuffer(audioData, AudioBuffer);
  });
}

module.exports = { get: get, set: set, decode: decode };